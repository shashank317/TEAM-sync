<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <title>Login â€“ TeamSync</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { inter: ['Inter', 'sans-serif'] },
          animation: {
            'aurora': 'aurora 60s linear infinite',
            'fade-in-up': 'fade-in-up 0.5s ease-out forwards',
          },
          keyframes: {
            aurora: {
              from: { 'background-position': '0% 50%' },
              to: { 'background-position': '200% 50%' },
            },
            'fade-in-up': {
                '0%': { opacity: '0', transform: 'translateY(10px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
            }
          }
        }
      }
    }
  </script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .hero-glow {
        background-image: radial-gradient(ellipse 80% 80% at 50% -20%, rgba(124, 58, 237, 0.3), rgba(255, 255, 255, 0));
    }
    .aurora-bg {
        background: radial-gradient(50% 100% at 50% 50%, rgba(29, 78, 216, 0.15) 0%, rgba(29, 78, 216, 0) 100%),
                    radial-gradient(40% 80% at 20% 70%, rgba(168, 85, 247, 0.1) 0%, rgba(168, 85, 247, 0) 100%),
                    radial-gradient(40% 80% at 80% 30%, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0) 100%);
        animation: aurora 20s infinite alternate;
    }
    @keyframes spin { to { transform: rotate(360deg) } }
    .spinner { animation: spin 1s linear infinite }
  </style>
</head>
<body class="bg-slate-950 text-gray-200 antialiased selection:bg-purple-500/50 selection:text-white">

  <!-- Background Decoratives -->
  <div class="absolute inset-0 -z-10 h-full w-full overflow-hidden">
    <div class="absolute -top-32 left-0 w-full h-[50rem] hero-glow"></div>
    <div class="absolute inset-0 aurora-bg"></div>
  </div>

  <div class="min-h-screen w-full flex items-center justify-center p-4">
    <div class="w-full max-w-6xl grid lg:grid-cols-5 gap-8">
      
      <!-- Left Column: Info -->
      <div class="hidden lg:flex lg:col-span-3 flex-col justify-center animate-fade-in-up">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center text-white font-bold border border-white/20">TS</div>
            <span class="text-2xl font-extrabold tracking-tight text-white">TeamSync</span>
        </div>
        <h1 class="text-4xl font-bold tracking-tight text-white mt-6">
            The Ultimate Project Hub for Modern Teams.
        </h1>
        <p class="mt-4 text-lg text-gray-400">
            Go from idea to launch faster. TeamSync provides everything you need to manage projects, without the complexity.
        </p>
        <div class="mt-8 bg-slate-900/50 backdrop-blur-xl rounded-2xl border border-white/10 p-6">
            <p class="text-sm text-gray-300">"TeamSync has streamlined our entire workflow. The Kanban board and analytics are game-changers for keeping our projects on track."</p>
            <div class="mt-4 flex items-center gap-3">
                <img src="https://placehold.co/40x40/a855f7/ffffff?text=AV&font=inter" alt="Avatar" class="w-10 h-10 rounded-full border-2 border-purple-400">
                <div>
                    <p class="font-semibold text-white">Alex Volkov</p>
                    <p class="text-xs text-gray-400">Lead Developer, TechCorp</p>
                </div>
            </div>
        </div>
      </div>

      <!-- Right Column: Login Card -->
      <div class="relative bg-slate-900/70 backdrop-blur-xl p-8 sm:p-10 rounded-2xl shadow-2xl w-full lg:col-span-2 border border-white/10 animate-fade-in-up" style="animation-delay: 200ms;">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-extrabold tracking-tight text-white">Welcome Back</h1>
            <p class="text-gray-400 mt-2 text-sm">Sign in to continue to TeamSync.</p>
        </div>

        <form id="loginForm" onsubmit="handleLogin(event)" class="space-y-6">
            <input id="email" type="email" autocomplete="email" required placeholder="Email Address" class="w-full px-4 py-3 rounded-lg border border-slate-700 bg-slate-800 text-white focus:ring-2 focus:ring-purple-500 outline-none">
            <input id="password" type="password" autocomplete="current-password" required placeholder="Password" class="w-full px-4 py-3 rounded-lg border border-slate-700 bg-slate-800 text-white focus:ring-2 focus:ring-purple-500 outline-none">
            <button id="loginButton" type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg shadow-lg font-semibold flex items-center justify-center gap-2">
                <span id="buttonText">Sign In</span>
                <div id="buttonSpinner" class="hidden w-5 h-5 border-2 border-white/70 border-t-transparent rounded-full spinner"></div>
            </button>
        </form>

        <div class="text-center mt-8 text-sm text-gray-400">
            Don't have an account? <a href="/signup" class="text-purple-400 font-semibold hover:underline">Create one</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed top-6 right-6 z-[100] hidden opacity-0 transition-opacity duration-300">
    <div id="toastInner" class="px-5 py-2.5 rounded-full text-sm font-medium shadow-2xl"></div>
  </div>

  <script>
    const ui = {
      form: document.getElementById('loginForm'),
      email: document.getElementById('email'),
      password: document.getElementById('password'),
      btn: document.getElementById('loginButton'),
      btnText: document.getElementById('buttonText'),
      btnSpinner: document.getElementById('buttonSpinner'),
      toast: document.getElementById('toast'),
      toastInner: document.getElementById('toastInner'),
    };

    let toastTimer;
    function showToast(msg, type = 'info') {
        clearTimeout(toastTimer);
        ui.toastInner.textContent = msg;
        ui.toastInner.className = "px-5 py-2.5 rounded-full text-sm font-medium shadow-2xl backdrop-blur-sm border";
        if (type === 'error') ui.toastInner.classList.add('bg-red-500/80', 'text-white', 'border-red-400');
        else if (type === 'success') ui.toastInner.classList.add('bg-green-500/80', 'text-white', 'border-green-400');
        else ui.toastInner.classList.add('bg-slate-800/80', 'text-white', 'border-slate-600');
        ui.toast.classList.remove('hidden');
        requestAnimationFrame(() => ui.toast.classList.remove('opacity-0'));
        toastTimer = setTimeout(() => {
            ui.toast.classList.add('opacity-0');
            setTimeout(() => ui.toast.classList.add('hidden'), 300);
        }, 3000);
    }

    function setLoading(state) {
        ui.btn.disabled = state;
        ui.btnText.classList.toggle('hidden', state);
        ui.btnSpinner.classList.toggle('hidden', !state);
    }

    async function handleLogin(e) {
        e.preventDefault();
        const email = ui.email.value.trim();
        const password = ui.password.value;
        if (!email || !password) { showToast('Email & password are required', 'error'); return; }
        setLoading(true);
        try {
            const res = await fetch('/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            if (res.ok) {
                const data = await res.json();
                localStorage.setItem('access_token', data.access_token);
                showToast('Login successful! Redirecting...', 'success');
                const params = new URLSearchParams(window.location.search);
                const next = params.get('next');
                setTimeout(() => window.location.href = next || '/dashboard', 900);
            } else {
                let detail = 'Login failed. Please check your credentials.';
                try { const err = await res.json(); detail = err.detail || detail; } catch {}
                showToast(detail, 'error');
            }
        } catch (err) {
            showToast('A network error occurred. Please try again.', 'error');
        } finally {
            setLoading(false);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        const next = params.get('next');
        const prompt = params.get('prompt');
        if (prompt === 'login') {
            localStorage.removeItem('access_token');
            fetch('/auth/logout', { method: 'POST' }).catch(() => {});
        }
        const existingToken = localStorage.getItem('access_token');
        if (existingToken && next && prompt !== 'login') {
            window.location.href = next;
            return;
        }
        ui.form.addEventListener('submit', handleLogin);
    });
  </script>
</body>
</html>

